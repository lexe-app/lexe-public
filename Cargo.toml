[workspace]
resolver = "2"

members = [
    "common",
    "lexe-ln",
    "node",
    "run-sgx",
]

[patch.crates-io]
# NOTE: Make sure to duplicate any changes to the `server`'s root Cargo.toml,
# otherwise the `server`'s dependency versions won't match.
aesm-client = { git = "https://github.com/lexe-tech/rust-sgx", branch = "lexe" }
async-usercalls = { git = "https://github.com/lexe-tech/rust-sgx", branch = "lexe" }
dcap-ql = { git = "https://github.com/lexe-tech/rust-sgx", branch = "lexe" }
enclave-runner = { git = "https://github.com/lexe-tech/rust-sgx", branch = "lexe" }
hyper = { git = "https://github.com/lexe-tech/hyper", branch = "hyper-sgx-0.14.18" }
mio = { git = "https://github.com/lexe-tech/mio", branch = "mio-sgx-0.8.4" }
reqwest = { git = "https://github.com/lexe-tech/reqwest", branch = "lexe" }
ring = { git = "https://github.com/lexe-tech/ring", branch = "support-sgx-0.16.20" }
sgx-isa = { git = "https://github.com/lexe-tech/rust-sgx", branch = "lexe" }
sgxs-loaders = { git = "https://github.com/lexe-tech/rust-sgx", branch = "lexe" }
tokio = { git = "https://github.com/lexe-tech/tokio",  branch = "tokio-sgx-1.21.2" }

# 0.0.112 introduced a bug which breaks our integration tests. The fix is
# implemented in https://github.com/lightningdevkit/rust-lightning/pull/1851.
# In the meantime, we have to use a git dependency until 0.0.113 is released.
# TODO(max): Comment this section out once 0.0.113 is released
lightning = { git = "https://github.com/lexe-tech/rust-lightning", branch = "lexe-v0.0.112-with-fix" }
lightning-block-sync = { git = "https://github.com/lexe-tech/rust-lightning", branch = "lexe-v0.0.112-with-fix" }
lightning-invoice = { git = "https://github.com/lexe-tech/rust-lightning", branch = "lexe-v0.0.112-with-fix" }
lightning-net-tokio = { git = "https://github.com/lexe-tech/rust-lightning", branch = "lexe-v0.0.112-with-fix" }

# For debugging LDK or testing patches during local development
# lightning = { path = "../ldk/lightning", features = ["max_level_trace"]}
# lightning-block-sync = { path = "../ldk/lightning-block-sync", features = [ "rpc-client" ] }
# lightning-invoice = { path = "../ldk/lightning-invoice" }
# lightning-net-tokio = { path = "../ldk/lightning-net-tokio" }

[profile.dev]
# This fixes 'warning: can't find symbol' when debugging, but breaks the
# server's build.rs, so it should always be commented out in git. More info:
# https://github.com/rust-lang/rust/issues/40787#issuecomment-1019465942
# https://doc.rust-lang.org/cargo/reference/profiles.html#split-debuginfo
# split-debuginfo = "packed"

[profile.release]
panic = "abort"
# NOTE(phlip9): enable for smaller binary size
# codegen-units = 1
# lto = true
# opt-level = "s"
# debug = 0
# strip = "debuginfo"

# [profile.dev]
# panic = "abort"
